import{bh as E,r,bf as l}from"./vendor-C6XvB-dI.js";import{d as h,m as N,R as P,n as R,o as T,b as j,B as v,p as B,M as F}from"./antd.bundle-B_TTaFv8.js";import{H as z}from"./index-CBfHJNae.js";import{u as A}from"./index-B9yEUu61.js";import{b as H}from"./index-BnrDp5rM.js";import{P as L}from"./charts.bundle-DBZrwueq.js";import"./library.bundle-BvrrzKl6.js";function Q(){const O=E(),[{query:p,save:k}]=A("LogObject","logger"),[w,c]=r.useState(!1),[s,u]=r.useState(!1),[d,I]=r.useState(!1),a=localStorage.getItem("currentUser")?JSON.parse(localStorage.getItem("currentUser")):{},x=localStorage.getItem("logger")?JSON.parse(localStorage.getItem("logger")):{},g=r.useMemo(()=>{const t=(s==null?void 0:s.yb)||{},e=Object.entries(t).sort((i,y)=>y[1]-i[1]).map(([i])=>i),o=(s==null?void 0:s.hty)||{},n=Object.entries(o).sort((i,y)=>y[1]-i[1]).map(([i])=>i);return(a==null?void 0:a.username)==="hty"?[...new Set([...n,...e])]:[...new Set([...e,...n])]},[a==null?void 0:a.username,s==null?void 0:s.hty,s==null?void 0:s.yb]),m=r.useMemo(()=>{let t=[];return a.username==="hty"?t.push("hty","yb"):t.push("yb","hty"),t},[a.username]),f=(t,e)=>{const o={...t};for(const n in e)o.hasOwnProperty(n)?typeof o[n]=="object"&&typeof e[n]=="object"&&o[n]!==null&&e[n]!==null?o[n]=f(o[n],e[n]):typeof o[n]=="number"&&typeof e[n]=="number"&&(o[n]+=e[n]):o[n]=e[n];return o},C=r.useMemo(()=>document.body.clientWidth>800?8:24,[]);r.useEffect(()=>{c(!0),p().then(t=>{const e=f(t||{},x);u(e);const o=localStorage.getItem("syncDate");h().diff(h(o),"day")>=7&&S(e),c(!1)})},[]);const M=()=>{F.confirm({content:"确认同步？",onOk(){c(!0),p().then(t=>{const e=f(t||{},x);u(e),S(e)})}})},S=t=>{k(t).then(()=>{localStorage.setItem("syncDate",h().format(H)),localStorage.removeItem("logger"),c(!1)}).catch(()=>{c(!1)})},b=t=>({data:g.map(e=>{var o,n;return Number((o=s==null?void 0:s[t])==null?void 0:o[e])>10?{type:e,value:(n=s==null?void 0:s[t])==null?void 0:n[e]}:null}).filter(e=>e),angleField:"value",colorField:"type",label:{text:"value",style:{fontWeight:"bold"}},legend:{color:{title:!1,position:"right",rowPadding:5}}}),D=[{key:"1",label:"卡片",children:l.jsx(N,{loading:w,children:l.jsx(P,{gutter:16,children:g.map(t=>l.jsx(R,{span:C,style:{marginTop:12},children:l.jsx(T,{title:t,bordered:!1,children:m.filter(e=>d?e===a.username:e).map(e=>{var o;return l.jsxs("p",{children:[e,": ",((o=s==null?void 0:s[e])==null?void 0:o[t])||0,"次"]},e)})})},t))})})},{key:"2",label:"图表",children:l.jsxs(j,{direction:"vertical",style:{width:"100%"},children:[l.jsxs("div",{children:[l.jsx("div",{style:{fontSize:30},children:a==null?void 0:a.username}),l.jsx(L,{...b(a==null?void 0:a.username)})]}),!d&&l.jsxs("div",{children:[l.jsx("div",{style:{fontSize:30},children:m.find(t=>t!==(a==null?void 0:a.username))}),l.jsx(L,{...b(m.find(t=>t!==(a==null?void 0:a.username)))})]})]})}];return l.jsxs("div",{style:{padding:24},children:[l.jsx(z,{style:{padding:0,margin:0},onBack:()=>O(-1),children:l.jsxs(j,{children:[l.jsx(v,{onClick:()=>I(!d),children:d?"双方都看":"只看自己"}),l.jsx(v,{type:"primary",onClick:M,children:"同步"})]})}),l.jsx(B,{items:D})]})}export{Q as default};
