import{bh as J,r as s,bf as e}from"./vendor-fW3smD4x.js";import{l as Y,r as G}from"./index-CkhOg_Qn.js";import{u as K}from"./index-_0Lhdygp.js";import{H as Q}from"./index-DCvgfadg.js";import{F as a,s as O,b as X,B as q,S as Z,M as H,h as ee,i as f,j as te,k as se}from"./antd.bundle-CIKUiC3j.js";import"./library.bundle-mtqYSBmT.js";const ne={required:"这个必须给我写！"},ae=({value:g})=>e.jsx("span",{children:g});function ue(){var F;const g=J(),[x]=a.useForm(),j=a.useWatch("isChallenge",x),u=a.useWatch("usePoint",x),[L]=K("HomeObject","playerList"),y=localStorage.getItem("currentUser")?JSON.parse(localStorage.getItem("currentUser")):{},[S]=s.useState(()=>({width:100,height:120,fontSize:60})),[M,c]=s.useState(!1),[h,T]=s.useState({}),[R,$]=s.useState(0),[B,p]=s.useState(!1),[o,I]=s.useState(),[d,w]=s.useState(!1),[v,U]=s.useState([]),[r,W]=s.useState([]),[m,E]=s.useState(0),N=s.useMemo(()=>r.filter(t=>t.coin).length,[r]),l=s.useMemo(()=>({max:parseInt(r.length/4),challenge:parseInt(r.length/(4*2))}),[r]),P=()=>{const{clientWidth:t,clientHeight:n}=document.body,i=parseInt(t/(S.width+16))*parseInt((n-52-48)/(S.height+16));let k=Array(i).fill(0).map((b,D)=>({id:D,coin:!1}));for(let b=0;b<Math.floor(Math.random()*7)+3;b++)k[G(k.length)].coin=!0;W(k)};s.useEffect(()=>{P(),C(!0)},[]),s.useEffect(()=>{const t=j?u*4:u*2;o==="1"?O.success(`挑战成功，用时${m}秒，增加${t}积分！`):o==="0"&&O.error(`挑战失败，扣减${u}积分！`),o&&(V(o==="1",t),I(null),w(!1))},[o]),s.useEffect(()=>{d||(clearInterval(window.currentInterval),E(0))},[d]),s.useEffect(()=>{d&&m>=(j?l.challenge:l.max)&&I("0")},[m]);const C=t=>{c(!0),L.query().then(n=>{n&&(U(n),t&&p(!0)),c(!1)})},A=t=>{T({...h,[t.id]:!0});const n=R+1;t.coin&&($(n),n===N&&I("1"))},V=(t,n)=>{c(!0),L.save(v.map(i=>i.player===y.username?{...i,point:t?i.point+n:i.point-u}:i)).then(()=>{C(),c(!1)}).catch(()=>{c(!1)})},z=()=>{C(),H.info({title:"排行榜",content:e.jsx(e.Fragment,{children:v.sort((t,n)=>n.point-t.point).map(t=>e.jsxs("div",{children:[t.player,"：",t.point]},t.player))})})},_=(j?l.challenge:l.max)-m;return e.jsxs(e.Fragment,{children:[e.jsx(Q,{style:{padding:"10px 36px",margin:0},onBack:()=>g("/home"),children:e.jsxs(X,{children:[d&&e.jsxs("span",{children:["剩余时间：",_>=0?_:0]}),e.jsx(q,{type:"primary",onClick:()=>{T({}),P(),p(!0)},children:"开始翻翻乐"}),e.jsx(q,{onClick:()=>z(),children:"排行榜"})]})}),e.jsxs(Z,{spinning:M,children:[e.jsx("div",{className:"warp",style:d?{}:{pointerEvents:"none",opacity:"0.5"},children:r.map(t=>e.jsx("div",{className:`card ${h[t.id]?"animate__animated animate__flipInY":""}`,onClick:()=>A(t),style:{...S,backgroundColor:h[t.id]?"#fff":"#eb5555"},children:h[t.id]?t.coin?e.jsx("i",{className:"nes-icon coin is-large"}):"":"?"},t.id))}),e.jsxs(H,{title:"翻翻乐",open:B,confirmLoading:M,onOk:()=>{w(!0),p(!1),Y("翻翻乐游戏"),window.currentInterval=setInterval(()=>{E(t=>t+1)},1e3)},onCancel:()=>p(!1),children:[e.jsx(ee,{message:e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["在",e.jsx(f.Text,{type:"danger",children:l.max}),"秒内找出全部硬币可获取2倍积分"]}),e.jsxs("div",{children:["勾选挑战在",e.jsx(f.Text,{type:"danger",children:l.challenge}),"秒内找出全部硬币可获取4倍积分"]}),e.jsxs("div",{children:["本轮卡片数",e.jsx(f.Text,{type:"danger",children:r.length}),"张，硬币数",e.jsx(f.Text,{type:"danger",children:N}),"个"]})]}),type:"info",showIcon:!0}),e.jsxs(a,{form:x,validateMessages:ne,style:{marginTop:12},children:[e.jsx(a.Item,{name:"player",label:"玩家",initialValue:y.username,children:e.jsx(ae,{})}),e.jsx(a.Item,{label:"积分",children:(F=(v||[]).find(t=>t.player===y.username))==null?void 0:F.point}),e.jsx(a.Item,{name:"usePoint",label:"本次参与使用积分",rules:[{required:!0}],initialValue:5,children:e.jsx(te,{precision:0,min:1})}),e.jsx(a.Item,{name:"isChallenge",label:"是否挑战",valuePropName:"checked",children:e.jsx(se,{})})]})]})]})]})}export{ue as default};
