import{r as l,bf as t,bp as F,bq as O,R as w}from"./vendor-fW3smD4x.js";import{H as M}from"./index-DCvgfadg.js";import{u as R}from"./index-_0Lhdygp.js";import{g as q,l as E}from"./index-DYtbvG6T.js";import{F as d,S as N,L as f,B as p,M as m,I as g,b as D}from"./antd.bundle-CIKUiC3j.js";import"./library.bundle-mtqYSBmT.js";const U={required:"这个必须给我写！"},T=({icon:r,text:u})=>t.jsxs(D,{children:[w.createElement(r),u]});function _(){const[r]=d.useForm(),u=localStorage.getItem("currentUser")?JSON.parse(localStorage.getItem("currentUser")):{},[{query:y,save:k}]=R("DiaryObject","diaryList"),[I,o]=l.useState(!1),[a,c]=l.useState([]),[j,i]=l.useState(!1),[x,b]=l.useState(null);l.useEffect(()=>{i(!0),y().then(e=>{e&&c(e),i(!1)})},[]);const h=e=>{i(!0),k(e).then(()=>{i(!1),o(!1),r.resetFields()}).catch(()=>{i(!1)})},L=()=>{r.validateFields().then(e=>{let s=[];x?s=a.map(n=>n.id===x.id?{...x,...e}:n):s=[...a,{...e,id:q(),createName:u.username}],c(s),E("添加记事簿"),h(s)})},v=e=>{o(!0),b(e),r.setFieldsValue({...e})},C=e=>{m.confirm({content:"确定删除吗？",onOk(){const s=a.filter(n=>n.id!==e.id);c(s),h(s)}})},S=e=>{const s=a.map(n=>n.id===e.id?{...n,likeCount:(n.likeCount||0)+1}:n);c(s),h(s)};return t.jsxs("div",{style:{padding:48},children:[t.jsx(M,{}),t.jsx(N,{spinning:j,children:t.jsx(f,{bordered:!0,header:t.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[t.jsx("span",{children:"想不出标题，所以我乱写一个"}),t.jsx(p,{type:"primary",onClick:()=>o(!0),children:"添加"})]}),style:{backgroundColor:"#fff"},dataSource:a,renderItem:e=>t.jsx(f.Item,{actions:[t.jsx("div",{onClick:()=>S(e),children:t.jsx(T,{icon:e.likeCount>0?F:O,text:e.likeCount},"list-vertical-like-o")},e.id)],extra:t.jsxs(t.Fragment,{children:[t.jsx(p,{type:"link",onClick:()=>v(e),children:"编辑"}),t.jsx(p,{danger:!0,type:"text",onClick:()=>C(e),children:"删除"})]}),children:t.jsx(f.Item.Meta,{avatar:t.jsx("i",{style:{width:100,height:100},className:e.createName==="yb"?"nes-ash":"nes-kirby"}),title:e.title,description:t.jsxs("div",{children:[t.jsx("div",{children:e.content}),t.jsxs("div",{style:{marginTop:4},children:["创建人：",e.createName||"hty"]})]})})},e.title)})}),t.jsx(m,{title:"添加",open:I,confirmLoading:j,onOk:L,onCancel:()=>{o(!1),r.resetFields()},children:t.jsxs(d,{form:r,validateMessages:U,children:[t.jsx(d.Item,{name:"title",label:"标题",rules:[{required:!0}],children:t.jsx(g,{})}),t.jsx(d.Item,{name:"content",label:"内容",rules:[{required:!0}],children:t.jsx(g.TextArea,{rows:3})})]})})]})}export{_ as default};
